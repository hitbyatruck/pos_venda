{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ equipamento.nome }} | {% trans "Detalhes do Equipamento" %}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="mb-0">
            <i class="fas fa-cog me-2"></i>{{ equipamento.nome }}
        </h1>
        <div>
            <a href="{% url 'equipamentos:editar_equipamento' equipamento_id=equipamento.id %}" class="btn btn-warning">
                <i class="fas fa-edit me-1"></i> {% trans "Editar" %}
            </a>
            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#excluirEquipamentoModal">
                <i class="fas fa-trash me-1"></i> {% trans "Excluir" %}
            </button>
            <div class="btn-group ms-2">
                <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="fas fa-plus-circle me-1"></i> {% trans "Ações" %}
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                        <a class="dropdown-item"
                            href="{% url 'assistencia:criar_pat' %}?equipamento={{ equipamento.id }}">
                            <i class="fas fa-tools me-1"></i> {% trans "Criar PAT" %}
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="{% url 'notas:criar_nota' %}?equipamento={{ equipamento.id }}">
                            <i class="fas fa-sticky-note me-1"></i> {% trans "Nova Nota" %}
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Breadcrumbs -->
    {% include 'equipamentos/includes/breadcrumbs.html' with view_title=equipamento.nome %}

    <!-- Mini Navigation -->
    {% include 'equipamentos/includes/menu_equipamentos.html' %}

    <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
            <h5 class="mb-0 font-weight-bold">
                <i class="fas fa-cog me-2"></i>{{ equipamento.nome }}
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <!-- Coluna para a imagem -->
                <div class="d-flex justify-content-center mb-4">
                    {% if equipamento.fotografia %}
                    <img src="{{ equipamento.fotografia.url }}" alt="Imagem do equipamento"
                        class="img-fluid rounded shadow"
                        style="max-width: 300px; height: auto; object-fit: cover; padding: 10px;">
                    {% else %}
                    <p class="text-muted">{% trans "Nenhuma imagem disponível." %}</p>
                    {% endif %}
                </div>
                <!-- Coluna para as informações -->
                <div class="col-md-8">
                    <p><strong>{% trans "Referência Interna:" %}</strong> {{ equipamento.referencia_interna }}</p>
                    <p><strong>{% trans "Categoria:" %}</strong> {{ equipamento.categoria }}</p>
                    <p><strong>{% trans "Data de Lançamento:" %}</strong> {{ equipamento.data_lancamento|default:"{%
                        trans 'Não especificado' %}" }}</p>
                    <p><strong>{% trans "Descrição:" %}</strong> {{ equipamento.descricao|linebreaks }}</p>
                    <p><strong>{% trans "Especificações:" %}</strong> {{ equipamento.especificacoes|linebreaks }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Related sections (like maintenance history, etc.) -->
    <div class="card shadow mb-4">
        <h2>{% trans "Documentos do Equipamento" %}</h2>
        <div>
            <table class="table">
                <thead>
                    <tr>
                        <th>{% trans "Nome do Ficheiro" %}</th>
                        <th>{% trans "Ações" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for documento in documentos %}
                    <tr>
                        <td>
                            <a href="{{ documento.arquivo.url }}" target="_blank">
                                {{ documento.arquivo.name|cut:"equipamentos_documentos/" }}
                            </a>
                        </td>
                        <td>
                            <button type="button" class="btn btn-danger btn-sm confirm-delete"
                                data-url="{% url 'equipamentos:excluir_documento' documento.id %}"
                                data-type="documento">
                                {% trans "Excluir" %}
                            </button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2">{% trans "Nenhum documento disponível." %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Delete Equipment Modal -->
<div class="modal fade" id="excluirEquipamentoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle me-2"></i>{% trans "Confirmar Exclusão" %}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>{% trans "Tem certeza que deseja excluir este equipamento?" %}</p>
                <p class="fw-bold">{{ equipamento.nome }}</p>
                <p class="text-danger">
                    <i class="fas fa-exclamation-circle me-1"></i>
                    {% trans "Esta ação não pode ser desfeita e todos os dados associados serão perdidos." %}
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    {% trans "Cancelar" %}
                </button>
                <form method="post" action="{% url 'equipamentos:excluir_equipamento' equipamento_id=equipamento.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i> {% trans "Excluir Equipamento" %}
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
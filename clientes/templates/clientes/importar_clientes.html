{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Importar Clientes" %}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h3 class="card-title mb-0">
                <i class="fas fa-file-import me-2"></i>
                {% trans "Importar Clientes" %}
            </h3>
        </div>
        <div class="card-body">
            <div class="alert alert-info">
                <h5 class="alert-heading"><i class="fas fa-info-circle me-2"></i>{% trans "Instruções" %}</h5>
                <p>{% trans "Para importar clientes, siga os seguintes passos:" %}</p>
                <ol>
                    <li>{% trans "Prepare um ficheiro CSV ou Excel com os dados dos clientes." %}</li>
                    <li>{% trans "Certifique-se que o ficheiro contém pelo menos as colunas: nome, email (obrigatórias)." %}</li>
                    <li>{% trans "Colunas opcionais: telefone, tipo, morada, codigo_postal, cidade, pais, nif." %}</li>
                    <li>{% trans "Selecione o ficheiro e o formato abaixo e clique em Importar." %}</li>
                </ol>
                <p><strong>{% trans "Nota:" %}</strong> {% trans "Se um cliente com o mesmo email já existir, seus dados serão atualizados." %}</p>
            </div>

            <form method="post" enctype="multipart/form-data" class="mt-4">
                {% csrf_token %}
                
                <div class="mb-3">
                    <label for="ficheiro_importacao" class="form-label">{% trans "Ficheiro para importação" %}</label>
                    <input type="file" class="form-control" id="ficheiro_importacao" name="ficheiro_importacao" required accept=".csv,.xlsx,.xls">
                    <div class="form-text">{% trans "Formatos suportados: CSV, Excel (.xlsx, .xls)" %}</div>
                </div>
                
                <div class="mb-3">
                    <label for="formato" class="form-label">{% trans "Formato do Ficheiro" %}</label>
                    <select class="form-select" id="formato" name="formato">
                        <option value="auto">{% trans "Automático (detectar pelo tipo de ficheiro)" %}</option>
                        <option value="csv">CSV</option>
                        <option value="excel">Excel</option>
                    </select>
                </div>
                
                <div class="d-flex justify-content-between">
                    <a href="{% url 'clientes:listar_clientes' %}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-1"></i>
                        {% trans "Voltar" %}
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-file-import me-1"></i>
                        {% trans "Importar" %}
                    </button>
                </div>
            </form>

            <!-- Download template files -->
            <div class="mt-4 pt-4 border-top">
                <h5>{% trans "Templates para Importação" %}</h5>
                <p>{% trans "Para facilitar sua importação, baixe um dos modelos abaixo:" %}</p>
                <div class="d-flex gap-3">
                    <a href="{% url 'clientes:download_template' formato='csv' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-file-csv me-1"></i>
                        {% trans "Baixar Template CSV" %}
                    </a>
                    <a href="{% url 'clientes:download_template' formato='excel' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-file-excel me-1"></i>
                        {% trans "Baixar Template Excel" %}
                    </a>
                </div>
            </div>

            <!-- Error display from previous import -->
            {% if erros_importacao %}
            <div class="mt-4">
                <div class="alert alert-danger">
                    <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>{% trans "Erros de Importação" %}</h5>
                    <p>{% trans "Os seguintes erros ocorreram durante a última importação:" %}</p>
                    <div class="overflow-auto" style="max-height: 300px;">
                        <ul class="mb-0">
                            {% for erro in erros_importacao %}
                            <li>{{ erro }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
